{{! Happening Topic }}

{{#if content}}
  {{#if loaded}}

    {{!#if view.firstPostLoaded}}
    <div id='topic-title'>
      <div class='container'>
<!-- Ed: taken out fancy title -->
      </div>
    </div>
    {{!/if}}
{{! Ed: removed container class  - as title above is not rendering, added style below to pad things.. }}
    <div class="posts " style="margin-top: 20px;">

      {{view Discourse.SelectedPostsView}}
      <div class="row">
        <section class="topic-area" id='topic' data-topic-id='{{unbound id}}'>
          <div class='posts-wrapper'>
            <div id='topic-progress-wrapper'>
              <nav id='topic-progress' title="{{i18n topic.progress.title}}" {{bindAttr class="hideProgress:hidden"}}>
                <button id='jump-top' title="{{i18n topic.progress.jump_top}}" {{action jumpTop}}><i class="icon-circle-arrow-up"></i></button>
                <div class='nums'>
                  <h4 title="{{i18n topic.progress.current}}">{{view.progressPosition}}</h4> <span>{{i18n of_value}}</span> <h4>{{filtered_posts_count}}</h4>
                </div>
                <button id='jump-bottom' title="{{i18n topic.progress.jump_bottom}}" {{action jumpBottom}}><i class="icon-circle-arrow-down"></i></button>
                <div class='bg'>&nbsp;</div>
              </nav>
            </div>

            {{#if loadingAbove}}
              <div class='spinner'>{{i18n loading}}</div>
            {{/if}}

{{! where posts get rendered: }}
            {{collection itemViewClass="Discourse.HappeningPostView" contentBinding="posts" topicViewBinding="view"}}

            {{#if loadingBelow}}
              <div class='spinner'>{{i18n loading}}</div>
            {{/if}}
          </div>
          <div id='topic-bottom'></div>

          {{#if loading}}
            {{#unless loadingBelow}}
              <div class='spinner small'>{{i18n loading}}</div>
            {{/unless}}
          {{else}}
            {{#if view.fullyLoaded}}

              {{view Discourse.TopicClosingView topicBinding="model"}}

              {{view Discourse.TopicFooterButtonsView topicBinding="model"}}

              {{#if suggested_topics.length}}
                <div id='suggested-topics'>

                  <h3>{{i18n suggested_topics.title}}</h3>

                  <div class='topics'>
                    <table id="topic-list">
                      <tr>
                        <th>
                          {{i18n topic.title}}
                        </th>
                        <th>{{i18n category_title}}</th>
                        <th class='num'>{{i18n posts}}</th>
                        <th class='num'>{{i18n likes}}</th>
                        <th class='num'>{{i18n views}}</th>
                        <th class='num activity' colspan='2'>{{i18n activity}}</th>
                      </tr>

                    {{each suggested_topics itemTagName="tr" itemViewClass="Discourse.SuggestedTopicView"}}
                    </table>
                  </div>
                  <br/>
                  <h3>{{{view.browseMoreMessage}}}</h3>
                </div>
              {{/if}}
            {{/if}}
          {{/if}}


        </section>
      </div>

    </div>

  {{else}}
    {{#if message}}
      <div class='container'>
        <div class='message'>

          <h2>{{message}}</h2>

          <p>
            {{#linkTo list.latest}}{{i18n topic.back_to_list}}{{/linkTo}}
        </div>
      </div>
    {{else}}
      <div class='container'>
      <!--
      don't care about loading on happening topics 
        <div class='spinner'>{{i18n loading}}</div>
      -->
      </div>
    {{/if}}
  {{/if}}
{{/if}}

<div id='topic-filter' style='display: none'>
  {{filterDesc}}
  <a href='#' {{action cancelFilter}}>{{i18n topic.filters.cancel}}</a>
</div>

{{render share}}
{{render quoteButton}}

{{#if currentUser.staff}}
  {{render topicAdminMenu content}}
{{/if}}

